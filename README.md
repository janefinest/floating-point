# Associativity of Floating Point Arithmetic
This repository represents an effort to address [usnistgov/discuss #8][_git]
by exploring floating-point rounding errors using float and MPFR data types

## Usage and Results

### Dependencies
- A C compiler, *e.g.* [GNU Compiler Collection][_gcc]
- Standard C libraries
- [MPFR][_gnu] library headers and runtime, version 4 or greater
  - On Debian derivatives, `$ apt-get install libmpfr4 libmpfr-dev`

### Built-in floating point representation
```bash
  $ gcc -O -Wall associative.c -o associative -lm && ./associative
  |  a             b             c           |  d             l             r           | equal |
  |  0.500000000   1.000000000  -1.000000000 |  0.500000000   0.500000000   0.500000000 | 1     |
  |  0.250000000   1.000000000  -1.000000000 |  0.250000000   0.250000000   0.250000000 | 1     |
  |  0.166666672   1.000000000  -1.000000000 |  0.166666627   0.166666627   0.166666672 | 0     |
  |  0.125000000   1.000000000  -1.000000000 |  0.125000000   0.125000000   0.125000000 | 1     |
  |  0.100000001   1.000000000  -1.000000000 |  0.100000024   0.100000024   0.100000001 | 0     |
  |  0.083333336   1.000000000  -1.000000000 |  0.083333373   0.083333373   0.083333336 | 0     |
  |  0.071428575   1.000000000  -1.000000000 |  0.071428537   0.071428537   0.071428575 | 0     |
  |  0.062500000   1.000000000  -1.000000000 |  0.062500000   0.062500000   0.062500000 | 1     |
  |  0.055555556   1.000000000  -1.000000000 |  0.055555582   0.055555582   0.055555556 | 0     |
  |  0.050000001   1.000000000  -1.000000000 |  0.049999952   0.049999952   0.050000001 | 0     |
  |  0.045454547   1.000000000  -1.000000000 |  0.045454502   0.045454502   0.045454547 | 0     |
  |  0.041666668   1.000000000  -1.000000000 |  0.041666627   0.041666627   0.041666668 | 0     |
  |  0.038461540   1.000000000  -1.000000000 |  0.038461566   0.038461566   0.038461540 | 0     |
  |  0.035714287   1.000000000  -1.000000000 |  0.035714269   0.035714269   0.035714287 | 0     |
  |  0.033333335   1.000000000  -1.000000000 |  0.033333302   0.033333302   0.033333335 | 0     |
  |  0.031250000   1.000000000  -1.000000000 |  0.031250000   0.031250000   0.031250000 | 1     |
```

### GNU MPFR floating-point representation
```bash
  $ gcc -O -Wall -include "mpfr.h" associative.c -o associative -lmpfr && ./associative
  |  a             b             c           |  d             l             r           | equal |
  |  0.500000000   1.000000000  -1.000000000 |  0.500000000   0.500000000   0.500000000 | 1     |
  |  0.250000000   1.000000000  -1.000000000 |  0.250000000   0.250000000   0.250000000 | 1     |
  |  0.166664124   1.000000000  -1.000000000 |  0.166656494   0.166656494   0.166664124 | 0     |
  |  0.125000000   1.000000000  -1.000000000 |  0.125000000   0.125000000   0.125000000 | 1     |
  |  0.099998474   1.000000000  -1.000000000 |  0.099975586   0.099975586   0.099998474 | 0     |
  |  0.083332062   1.000000000  -1.000000000 |  0.083312988   0.083312988   0.083332062 | 0     |
  |  0.071428299   1.000000000  -1.000000000 |  0.071411133   0.071411133   0.071428299 | 0     |
  |  0.062500000   1.000000000  -1.000000000 |  0.062500000   0.062500000   0.062500000 | 1     |
  |  0.055555344   1.000000000  -1.000000000 |  0.055541992   0.055541992   0.055555344 | 0     |
  |  0.049999237   1.000000000  -1.000000000 |  0.049987793   0.049987793   0.049999237 | 0     |
  |  0.045454025   1.000000000  -1.000000000 |  0.045440674   0.045440674   0.045454025 | 0     |
  |  0.041666031   1.000000000  -1.000000000 |  0.041656494   0.041656494   0.041666031 | 0     |
  |  0.038460732   1.000000000  -1.000000000 |  0.038452148   0.038452148   0.038460732 | 0     |
  |  0.035714149   1.000000000  -1.000000000 |  0.035705566   0.035705566   0.035714149 | 0     |
  |  0.033332825   1.000000000  -1.000000000 |  0.033325195   0.033325195   0.033332825 | 0     |
  |  0.031250000   1.000000000  -1.000000000 |  0.031250000   0.031250000   0.031250000 | 1     |
```

### Optimized floating-point representation
`-funsafe-math-optimizations` enables optimizations that allow arbitrary reassociations and
transformations with no accuracy guarantees. It also does not try to preserve the sign of zeros.
```bash
  $ gcc -O -Wall -pedantic -funsafe-math-optimizations associative.c -o associative -lm && ./associative
  |  a             b             c           |  d             l             r           | equal |
  |  0.500000000   1.000000000  -1.000000000 |  0.500000000   0.500000000   0.500000000 | 1     |
  |  0.250000000   1.000000000  -1.000000000 |  0.250000000   0.250000000   0.250000000 | 1     |
  |  0.166666672   1.000000000  -1.000000000 |  0.166666672   0.166666672   0.166666672 | 1     |
  |  0.125000000   1.000000000  -1.000000000 |  0.125000000   0.125000000   0.125000000 | 1     |
  |  0.100000001   1.000000000  -1.000000000 |  0.100000001   0.100000001   0.100000001 | 1     |
  |  0.083333336   1.000000000  -1.000000000 |  0.083333336   0.083333336   0.083333336 | 1     |
  |  0.071428575   1.000000000  -1.000000000 |  0.071428575   0.071428575   0.071428575 | 1     |
  |  0.062500000   1.000000000  -1.000000000 |  0.062500000   0.062500000   0.062500000 | 1     |
  |  0.055555556   1.000000000  -1.000000000 |  0.055555556   0.055555556   0.055555556 | 1     |
  |  0.050000001   1.000000000  -1.000000000 |  0.050000001   0.050000001   0.050000001 | 1     |
  |  0.045454547   1.000000000  -1.000000000 |  0.045454547   0.045454547   0.045454547 | 1     |
  |  0.041666668   1.000000000  -1.000000000 |  0.041666668   0.041666668   0.041666668 | 1     |
  |  0.038461540   1.000000000  -1.000000000 |  0.038461540   0.038461540   0.038461540 | 1     |
  |  0.035714287   1.000000000  -1.000000000 |  0.035714287   0.035714287   0.035714287 | 1     |
  |  0.033333335   1.000000000  -1.000000000 |  0.033333335   0.033333335   0.033333335 | 1     |
  |  0.031250000   1.000000000  -1.000000000 |  0.031250000   0.031250000   0.031250000 | 1     |
```

```bash
  $ gcc -O -Wall -pedantic -include "mpfr.h" -funsafe-math-optimizations associative.c -o associative -lmpfr && ./associative
  |  a             b             c           |  d             l             r           | equal |
  |  0.500000000   1.000000000  -1.000000000 |  0.500000000   0.500000000   0.500000000 | 1     |
  |  0.250000000   1.000000000  -1.000000000 |  0.250000000   0.250000000   0.250000000 | 1     |
  |  0.166664124   1.000000000  -1.000000000 |  0.166656494   0.166656494   0.166664124 | 0     |
  |  0.125000000   1.000000000  -1.000000000 |  0.125000000   0.125000000   0.125000000 | 1     |
  |  0.099998474   1.000000000  -1.000000000 |  0.099975586   0.099975586   0.099998474 | 0     |
  |  0.083332062   1.000000000  -1.000000000 |  0.083312988   0.083312988   0.083332062 | 0     |
  |  0.071428299   1.000000000  -1.000000000 |  0.071411133   0.071411133   0.071428299 | 0     |
  |  0.062500000   1.000000000  -1.000000000 |  0.062500000   0.062500000   0.062500000 | 1     |
  |  0.055555344   1.000000000  -1.000000000 |  0.055541992   0.055541992   0.055555344 | 0     |
  |  0.049999237   1.000000000  -1.000000000 |  0.049987793   0.049987793   0.049999237 | 0     |
  |  0.045454025   1.000000000  -1.000000000 |  0.045440674   0.045440674   0.045454025 | 0     |
  |  0.041666031   1.000000000  -1.000000000 |  0.041656494   0.041656494   0.041666031 | 0     |
  |  0.038460732   1.000000000  -1.000000000 |  0.038452148   0.038452148   0.038460732 | 0     |
  |  0.035714149   1.000000000  -1.000000000 |  0.035705566   0.035705566   0.035714149 | 0     |
  |  0.033332825   1.000000000  -1.000000000 |  0.033325195   0.033325195   0.033332825 | 0     |
  |  0.031250000   1.000000000  -1.000000000 |  0.031250000   0.031250000   0.031250000 | 1     |
```

### Discussion
As [@JRMatey-NIST noted][_jmt], this is a straight-forward byproduct of the binary
representation of floating-point numbers. Exact representation is possible for integral
exponents of 2; any other number incurs [rounding error][_rnd].

<!--References-->
[_gcc]: https://gcc.gnu.org/
[_git]: https://github.com/usnistgov/discuss/issues/8
[_gnu]: http://www.mpfr.org/
[_jmt]: https://github.com/usnistgov/discuss/issues/8#issuecomment-392554151
[_rnd]: https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html#680
